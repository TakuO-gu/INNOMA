<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>歌志内市 - 市民ポータル | INNOMA</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        :root {
            --bs-primary: #0d6efd;
            --bs-secondary: #6c757d;
            --bs-danger: #dc3545;
            --bs-warning: #ffc107;
            --bs-success: #198754;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background-color: #f8f9fa;
        }

        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }

        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 1.5rem;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        }

        .badge-importance-high {
            background-color: var(--bs-danger);
        }

        .badge-importance-medium {
            background-color: var(--bs-warning);
            color: #000;
        }

        .badge-importance-low {
            background-color: var(--bs-secondary);
        }

        .section-header {
            border-left: 4px solid var(--bs-primary);
            padding-left: 1rem;
            margin: 2rem 0 1.5rem 0;
        }

        .stats-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--bs-primary);
        }

        .emergency-alert {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .news-date {
            color: #6c757d;
            font-size: 0.875rem;
        }

        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        footer {
            background-color: #343a40;
            color: white;
            padding: 2rem 0;
            margin-top: 4rem;
        }

        .metadata-badge {
            background-color: #e9ecef;
            color: #495057;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            display: inline-block;
            margin: 0.25rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-building"></i> INNOMA
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#news">ニュース</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#events">イベント</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#procedures">手続き</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#facilities">施設</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-4 fw-bold mb-3">
                        <i class="bi bi-geo-alt-fill"></i> 歌志内市
                    </h1>
                    <p class="lead mb-3">北海道 | 日本一小さな市</p>
                    <div class="metadata-badge">
                        <i class="bi bi-clock-history"></i> 最終更新: <span id="lastUpdate"></span>
                    </div>
                    <div class="metadata-badge">
                        <i class="bi bi-star-fill"></i> データ信頼度: <span id="confidence"></span>%
                    </div>
                    <div class="metadata-badge">
                        <i class="bi bi-cpu"></i> AI処理時間: <span id="processingTime"></span>秒
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stats-card">
                        <div class="stats-number" id="totalItems">0</div>
                        <div class="text-muted">件の情報</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Emergency Alerts -->
        <div id="emergencySection"></div>

        <!-- News Section -->
        <h2 class="section-header" id="news">
            <i class="bi bi-newspaper"></i> ニュース・お知らせ
        </h2>
        <div class="row" id="newsSection"></div>

        <!-- Events Section -->
        <h2 class="section-header" id="events">
            <i class="bi bi-calendar-event"></i> イベント情報
        </h2>
        <div class="row" id="eventsSection"></div>

        <!-- Procedures Section -->
        <h2 class="section-header" id="procedures">
            <i class="bi bi-file-text"></i> 手続き・サービス
        </h2>
        <div class="row" id="proceduresSection"></div>

        <!-- Facilities Section -->
        <h2 class="section-header" id="facilities">
            <i class="bi bi-hospital"></i> 施設情報
        </h2>
        <div class="row" id="facilitiesSection"></div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container text-center">
            <p class="mb-2">
                <i class="bi bi-robot"></i> このページはINNOMAプロジェクトにより
                <a href="https://www.city.utashinai.hokkaido.jp/" target="_blank" class="text-white">歌志内市公式サイト</a>
                から自動生成されました
            </p>
            <p class="text-muted small">
                AI処理: <span id="footerModel"></span> | アクセシビリティ AA準拠
            </p>
            <p class="text-muted small">
                <a href="https://github.com/innoma" class="text-white">GitHub</a> |
                <a href="https://discord.gg/innoma" class="text-white">Discord</a>
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // データを読み込む
        let municipalData = null;

        // 日付フォーマット関数
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'short'
            });
        }

        // 重要度バッジを生成
        function getImportanceBadge(importance) {
            const labels = {
                high: '重要',
                medium: '注目',
                low: 'お知らせ'
            };
            return `<span class="badge badge-importance-${importance} me-2">${labels[importance] || importance}</span>`;
        }

        // 緊急情報を表示
        function renderEmergency(emergencyList) {
            if (!emergencyList || emergencyList.length === 0) return;

            const html = emergencyList.map(item => `
                <div class="emergency-alert">
                    <div class="d-flex align-items-start">
                        <div class="flex-shrink-0">
                            <i class="bi bi-exclamation-triangle-fill" style="font-size: 2rem;"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h4 class="mb-2">
                                ${getImportanceBadge(item.importance)}
                                ${item.title}
                            </h4>
                            <a href="${item.url}" class="btn btn-light btn-sm" target="_blank">
                                <i class="bi bi-box-arrow-up-right"></i> 詳細を見る
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('emergencySection').innerHTML = html;
        }

        // ニュースを表示
        function renderNews(newsList) {
            if (!newsList || newsList.length === 0) {
                document.getElementById('newsSection').innerHTML = '<p class="text-muted">現在お知らせはありません</p>';
                return;
            }

            const html = newsList.map(item => `
                <div class="col-md-6 col-lg-4">
                    <div class="card">
                        <div class="card-body">
                            <div class="mb-2">
                                ${getImportanceBadge(item.importance)}
                                <span class="news-date">
                                    <i class="bi bi-calendar3"></i> ${formatDate(item.date)}
                                </span>
                            </div>
                            <h5 class="card-title">${item.title}</h5>
                            <a href="${item.url}" class="btn btn-outline-primary btn-sm" target="_blank">
                                <i class="bi bi-arrow-right"></i> 詳細
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('newsSection').innerHTML = html;
        }

        // イベントを表示
        function renderEvents(eventsList) {
            if (!eventsList || eventsList.length === 0) {
                document.getElementById('eventsSection').innerHTML = '<p class="text-muted">現在イベントはありません</p>';
                return;
            }

            const html = eventsList.map(item => `
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="mb-2">
                                <span class="badge bg-primary">
                                    <i class="bi bi-calendar-event"></i> イベント
                                </span>
                            </div>
                            <h5 class="card-title">${item.title}</h5>
                            <p class="mb-2">
                                <i class="bi bi-clock"></i> ${formatDate(item.date)}
                            </p>
                            <a href="${item.url}" class="btn btn-outline-primary btn-sm" target="_blank">
                                <i class="bi bi-arrow-right"></i> 詳細
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('eventsSection').innerHTML = html;
        }

        // 手続きを表示
        function renderProcedures(proceduresList) {
            if (!proceduresList || proceduresList.length === 0) {
                document.getElementById('proceduresSection').innerHTML = '<p class="text-muted">現在手続き情報はありません</p>';
                return;
            }

            const html = proceduresList.map(item => `
                <div class="col-md-6 col-lg-4">
                    <div class="card">
                        <div class="card-body">
                            <div class="mb-2">
                                <span class="badge bg-success">
                                    <i class="bi bi-file-text"></i> 手続き
                                </span>
                            </div>
                            <h5 class="card-title">${item.title}</h5>
                            ${getImportanceBadge(item.importance)}
                            <div class="mt-3">
                                <a href="${item.url}" class="btn btn-outline-success btn-sm" target="_blank">
                                    <i class="bi bi-arrow-right"></i> 手続き方法を見る
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('proceduresSection').innerHTML = html;
        }

        // 施設を表示
        function renderFacilities(facilitiesList) {
            if (!facilitiesList || facilitiesList.length === 0) {
                document.getElementById('facilitiesSection').innerHTML = '<p class="text-muted">現在施設情報はありません</p>';
                return;
            }

            const html = facilitiesList.map(item => `
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="mb-2">
                                <span class="badge bg-info">
                                    <i class="bi bi-building"></i> 施設
                                </span>
                            </div>
                            <h5 class="card-title">${item.title}</h5>
                            ${getImportanceBadge(item.importance)}
                            <div class="mt-3">
                                <a href="${item.url}" class="btn btn-outline-info btn-sm" target="_blank">
                                    <i class="bi bi-arrow-right"></i> 施設情報
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('facilitiesSection').innerHTML = html;
        }

        // メタデータを表示
        function renderMetadata(metadata) {
            document.getElementById('lastUpdate').textContent = formatDate(metadata.extractedAt);
            document.getElementById('confidence').textContent = (metadata.confidence * 100).toFixed(0);
            document.getElementById('processingTime').textContent = (metadata.processingTimeMs / 1000).toFixed(2);
            document.getElementById('footerModel').textContent = metadata.llmModel;
        }

        // 統計を計算
        function calculateStats(data) {
            const total =
                (data.news?.length || 0) +
                (data.events?.length || 0) +
                (data.procedures?.length || 0) +
                (data.facilities?.length || 0) +
                (data.emergencyInfo?.length || 0);

            document.getElementById('totalItems').textContent = total;
        }

        // データを読み込んで表示
        async function loadData() {
            try {
                const response = await fetch('data.json');
                municipalData = await response.json();

                renderMetadata(municipalData.metadata);
                calculateStats(municipalData);
                renderEmergency(municipalData.emergencyInfo);
                renderNews(municipalData.news);
                renderEvents(municipalData.events);
                renderProcedures(municipalData.procedures);
                renderFacilities(municipalData.facilities);
            } catch (error) {
                console.error('データの読み込みに失敗しました:', error);
                document.querySelector('.container').innerHTML = `
                    <div class="alert alert-danger" role="alert">
                        <i class="bi bi-exclamation-triangle"></i> データの読み込みに失敗しました。
                        data.jsonファイルが存在するか確認してください。
                    </div>
                `;
            }
        }

        // ページ読み込み時にデータを取得
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
