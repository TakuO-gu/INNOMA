<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>歌志内市 LocalGov準拠ポータル | INNOMA</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        :root {
            --localgov-blue: #1d70b8;
            --localgov-green: #00703c;
            --localgov-red: #d4351c;
            --localgov-yellow: #ffdd00;
            --localgov-black: #0b0c0c;
            --localgov-grey-1: #f3f2f1;
            --localgov-grey-2: #b1b4b6;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Arial, sans-serif;
            background-color: var(--localgov-grey-1);
            color: var(--localgov-black);
        }

        /* GOV.UK / LocalGov スタイル */
        .localgov-header {
            background-color: var(--localgov-black);
            color: white;
            padding: 1rem 0;
            border-bottom: 10px solid var(--localgov-blue);
        }

        .localgov-header .brand {
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* Service Page スタイル */
        .service-page {
            background: white;
            padding: 2rem;
            margin: 2rem 0;
            border-left: 5px solid var(--localgov-blue);
        }

        .service-page .summary {
            font-size: 1.125rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: var(--localgov-grey-1);
            border-left: 4px solid var(--localgov-blue);
        }

        .task-button {
            background-color: var(--localgov-green);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.125rem;
            font-weight: bold;
            border-radius: 0;
            margin: 2rem 0;
            display: inline-block;
            text-decoration: none;
        }

        .task-button:hover {
            background-color: #005a30;
            color: white;
        }

        .task-button.top-task {
            background-color: var(--localgov-red);
        }

        .task-button.top-task:hover {
            background-color: #aa2a16;
        }

        /* Guide Page スタイル */
        .guide-page {
            background: white;
            padding: 2rem;
            margin: 2rem 0;
        }

        .guide-landing {
            border-left: 5px solid var(--localgov-green);
            padding-left: 1.5rem;
        }

        .guide-child-page {
            border: 1px solid var(--localgov-grey-2);
            padding: 1.5rem;
            margin: 1rem 0;
            transition: border-color 0.2s;
        }

        .guide-child-page:hover {
            border-color: var(--localgov-blue);
        }

        .guide-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid var(--localgov-grey-2);
        }

        /* Step-by-step スタイル */
        .step-by-step-page {
            background: white;
            padding: 2rem;
            margin: 2rem 0;
            border-left: 5px solid var(--localgov-yellow);
        }

        .step-intro {
            font-size: 1.125rem;
            margin-bottom: 2rem;
            max-width: 600px;
        }

        .step-list {
            list-style: none;
            padding: 0;
            counter-reset: step-counter;
        }

        .step-item {
            counter-increment: step-counter;
            padding: 1.5rem;
            margin: 1rem 0;
            border: 2px solid var(--localgov-grey-2);
            position: relative;
        }

        .step-item::before {
            content: counter(step-counter);
            position: absolute;
            left: -20px;
            top: 10px;
            background-color: var(--localgov-black);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.25rem;
        }

        .step-task {
            margin: 0.5rem 0 0.5rem 2rem;
            padding: 0.75rem;
            background-color: var(--localgov-grey-1);
        }

        .step-task .fee {
            color: var(--localgov-red);
            font-weight: bold;
        }

        /* Related Links */
        .related-links {
            background-color: var(--localgov-grey-1);
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .related-links h3 {
            font-size: 1.125rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .related-links ul {
            list-style: none;
            padding: 0;
        }

        .related-links li {
            margin-bottom: 0.75rem;
        }

        .related-links a {
            color: var(--localgov-blue);
            text-decoration: underline;
        }

        /* Emergency Alert */
        .emergency-alert {
            background-color: var(--localgov-red);
            color: white;
            padding: 1.5rem;
            margin: 2rem 0;
            border-left: 10px solid #aa2a16;
        }

        .emergency-alert h2 {
            color: white;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        /* Breadcrumb */
        .localgov-breadcrumb {
            background-color: var(--localgov-grey-1);
            padding: 1rem 0;
        }

        .localgov-breadcrumb ol {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-wrap: wrap;
        }

        .localgov-breadcrumb li {
            margin-right: 0.5rem;
        }

        .localgov-breadcrumb li::after {
            content: ">";
            margin-left: 0.5rem;
            color: var(--localgov-grey-2);
        }

        .localgov-breadcrumb li:last-child::after {
            content: "";
        }

        /* Footer */
        .localgov-footer {
            background-color: var(--localgov-grey-1);
            border-top: 2px solid var(--localgov-grey-2);
            padding: 2rem 0;
            margin-top: 4rem;
        }

        /* Page type badge */
        .page-type-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: bold;
            margin-bottom: 1rem;
            border-radius: 0;
        }

        .page-type-badge.service {
            background-color: var(--localgov-blue);
            color: white;
        }

        .page-type-badge.guide {
            background-color: var(--localgov-green);
            color: white;
        }

        .page-type-badge.step-by-step {
            background-color: var(--localgov-yellow);
            color: var(--localgov-black);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="localgov-header">
        <div class="container">
            <div class="brand">
                <i class="bi bi-building"></i> 歌志内市 | INNOMA
            </div>
        </div>
    </header>

    <!-- Breadcrumb -->
    <nav class="localgov-breadcrumb" aria-label="Breadcrumb">
        <div class="container">
            <ol>
                <li><a href="/">ホーム</a></li>
                <li><a href="/services">行政サービス</a></li>
                <li>現在のページ</li>
            </ol>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <!-- Emergency Alerts -->
        <div id="emergencySection"></div>

        <!-- Service Pages -->
        <div id="servicePages"></div>

        <!-- Guide Pages -->
        <div id="guidePages"></div>

        <!-- Step-by-step Pages -->
        <div id="stepByStepPages"></div>
    </main>

    <!-- Footer -->
    <footer class="localgov-footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h3 class="h5">歌志内市について</h3>
                    <p class="text-muted small">
                        このページはINNOMAプロジェクトにより
                        <a href="https://www.city.utashinai.hokkaido.jp/" target="_blank">歌志内市公式サイト</a>
                        から自動生成されました。
                    </p>
                </div>
                <div class="col-md-6">
                    <h3 class="h5">リンク</h3>
                    <ul class="list-unstyled small">
                        <li><a href="https://github.com/innoma">GitHub</a></li>
                        <li><a href="https://discord.gg/innoma">Discord</a></li>
                        <li><a href="/accessibility">アクセシビリティ方針</a></li>
                    </ul>
                </div>
            </div>
            <div class="mt-3 text-muted small">
                <p>LocalGov Drupal 準拠 | WCAG 2.1 AA準拠</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Service Page レンダリング
        function renderServicePage(page) {
            return `
                <div class="service-page">
                    <span class="page-type-badge service">Service page</span>

                    <h1>${page.title}</h1>

                    <div class="summary">
                        ${page.summary}
                    </div>

                    ${page.sections.map(section => `
                        <section>
                            <h2>${section.heading}</h2>
                            <p>${section.content}</p>
                        </section>
                    `).join('')}

                    <a href="${page.primaryTask.url}"
                       class="task-button ${page.primaryTask.isTopTask ? 'top-task' : ''}">
                        ${page.primaryTask.label}
                    </a>

                    ${page.relatedLinks && page.relatedLinks.length > 0 ? `
                        <div class="related-links">
                            <h3>関連する情報</h3>
                            <ul>
                                ${page.relatedLinks.map(link => `
                                    <li>
                                        <a href="${link.url}">${link.title}</a>
                                        ${link.description ? `<br><small class="text-muted">${link.description}</small>` : ''}
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Guide Page レンダリング
        function renderGuidePage(page) {
            return `
                <div class="guide-page">
                    <span class="page-type-badge guide">Guide page</span>

                    <div class="guide-landing">
                        <h1>${page.title}</h1>
                        <p class="lead">${page.overview}</p>
                    </div>

                    <div class="mt-4">
                        ${page.pages.map((childPage, index) => `
                            <div class="guide-child-page">
                                <h2>${childPage.title}</h2>
                                <p>${childPage.summary}</p>
                                <a href="${childPage.url}" class="btn btn-outline-primary">
                                    詳細を見る <i class="bi bi-arrow-right"></i>
                                </a>
                            </div>

                            ${index < page.pages.length - 1 ? `
                                <div class="guide-nav">
                                    <a href="${page.pages[index + 1].url}" class="btn btn-link">
                                        <i class="bi bi-arrow-right"></i> 次: ${page.pages[index + 1].title}
                                    </a>
                                </div>
                            ` : ''}
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Step-by-step Page レンダリング
        function renderStepByStepPage(page) {
            return `
                <div class="step-by-step-page">
                    <span class="page-type-badge step-by-step">Step by step</span>

                    <h1>${page.title}</h1>

                    <p class="step-intro">${page.introduction}</p>

                    <ol class="step-list">
                        ${page.steps.map(step => `
                            <li class="step-item">
                                <h2>${step.title}</h2>
                                <p>${step.description}</p>

                                ${step.tasks.map(task => `
                                    <div class="step-task">
                                        <a href="${task.url}">${task.title}</a>
                                        ${task.fee ? `<span class="fee ms-2">${task.fee}</span>` : ''}
                                        ${task.estimatedTime ? `<span class="text-muted ms-2">(${task.estimatedTime})</span>` : ''}
                                    </div>
                                `).join('')}

                                ${step.alternativeSteps && step.alternativeSteps.length > 0 ? `
                                    <div class="mt-3">
                                        <h3 class="h6">または</h3>
                                        ${step.alternativeSteps.map(alt => `
                                            <div class="ms-3">
                                                <strong>${alt.title}</strong>
                                                <p class="small">${alt.description}</p>
                                                ${alt.tasks.map(task => `
                                                    <div class="step-task">
                                                        <a href="${task.url}">${task.title}</a>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                            </li>
                        `).join('')}
                    </ol>

                    <div class="mt-4 p-3 bg-light">
                        <p class="mb-0"><strong>所要時間:</strong> ${page.estimatedDuration || '不明'}</p>
                        <p class="mb-0"><strong>総ステップ数:</strong> ${page.totalSteps}</p>
                    </div>
                </div>
            `;
        }

        // Emergency Alert レンダリング
        function renderEmergencyAlert(alert) {
            return `
                <div class="emergency-alert" role="alert">
                    <h2><i class="bi bi-exclamation-triangle-fill"></i> ${alert.title}</h2>
                    <p>${alert.content}</p>
                    ${alert.url ? `<a href="${alert.url}" class="btn btn-light">詳細を見る</a>` : ''}
                </div>
            `;
        }

        // データを読み込んで表示
        async function loadData() {
            try {
                const response = await fetch('localgov-data.json');
                const data = await response.json();

                // 緊急アラート
                if (data.emergencyAlerts && data.emergencyAlerts.length > 0) {
                    document.getElementById('emergencySection').innerHTML = data.emergencyAlerts
                        .map(renderEmergencyAlert)
                        .join('');
                }

                // ページをタイプ別に分類して表示
                const servicePages = data.pages.filter(p => p.type === 'service');
                const guidePages = data.pages.filter(p => p.type === 'guide');
                const stepByStepPages = data.pages.filter(p => p.type === 'step-by-step');

                document.getElementById('servicePages').innerHTML = servicePages
                    .map(renderServicePage)
                    .join('');

                document.getElementById('guidePages').innerHTML = guidePages
                    .map(renderGuidePage)
                    .join('');

                document.getElementById('stepByStepPages').innerHTML = stepByStepPages
                    .map(renderStepByStepPage)
                    .join('');

            } catch (error) {
                console.error('データの読み込みに失敗しました:', error);
                document.querySelector('main').innerHTML = `
                    <div class="alert alert-danger" role="alert">
                        <i class="bi bi-exclamation-triangle"></i> データの読み込みに失敗しました。
                        localgov-data.jsonファイルが存在するか確認してください。
                    </div>
                `;
            }
        }

        // ページ読み込み時にデータを取得
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>