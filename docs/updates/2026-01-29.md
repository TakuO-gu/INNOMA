# 2026-01-29 更新履歴

## [設定変更]

- 管理画面および管理APIに認証（Bearer/Basic）を追加
- Cronエンドポイントのシークレット必須化

## [セキュリティ]

- 管理APIのパラメータ検証を追加しパストラバーサルを防止
- OCR APIにSSR​F対策（公式ドメイン/許可ドメイン制限、プライベートIP遮断）を追加

## [バグ修正]

- 下書き承認/却下の監査ログに実ユーザー名を記録
- ISR再検証をレイアウト単位に修正し動的ルートの更新漏れを回避

## [仕様調整]

- メール変数に問い合わせフォームURLを許容（検証・表示・入力の全経路を対応）
- 高岡市の総務課メールを問い合わせフォームURLに更新
- 未取得変数に対してLLMが代替案を提案し、管理画面で採用/却下できる仕組みを追加
- 管理画面認証をBasicのみに変更（Bearer削除）

## [ドキュメント更新]

### INNOMA_FlowChart.md の実装整合性修正

以下の問題を修正し、フローチャートと実装の整合性を確保:

1. **用語説明セクション追加**（セクション1.1）
   - 用語を3カテゴリに分類：システム全体、市民向けサイト、管理画面
   - 「ホームページ」を「自治体トップ」に変更し、INNOMA自体のトップとの混同を回避
   - 管理画面の各ページ（ダッシュボード、自治体一覧、下書き一覧等）の用語を追加
   - ページ階層図を追加（自治体トップ → トピック一覧 → トピックページ → サービスページ）

2. **データ保存場所の修正**（セクション4）
   - ディレクトリ名を日本語名（高岡市）から英語ID（takaoka）に修正
   - `_jobs/`ディレクトリの説明を追加
   - ディレクトリ構造を実際の`services/`・`topics/`階層に合わせて詳細化
   - `meta.json`, `variables.json`, `districts.json`等のファイル役割を追加

3. **市民がページを見るまでの流れ**（セクション5）
   - URLパス例を実際の形式（`/takaoka/services/environment/gomi`）に修正
   - 変数置換の仕組みの説明を追加

4. **管理者の作業フロー**（セクション3）
   - 認証なし（開発中）の注記を追加
   - 管理画面のURLパスを明記
   - ISR再検証の説明を追加

5. **下書き承認フロー**（セクション7）
   - シーケンス図を実装に合わせて詳細化
   - サービス単位でのループ処理を明記
   - APIエンドポイント名を追加
   - 下書きのデータ構造（variables, missingVariables, searchAttempts等）を追加

6. **部品の役割まとめ**（セクション8）
   - 「Artifact」の説明を追加
   - 各部品の保存場所列を追加
