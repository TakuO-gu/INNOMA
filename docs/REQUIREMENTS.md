# INNOMA 要件定義書

**作成日**: 2026-01-20
**バージョン**: 2.0

---

## 1. プロジェクト概要

### 1.1 ミッション
すべての自治体サイトを「迷わず辿り着ける・読める・操作できる」体験に統一し、災害・行政手続き情報を誰一人取り残さず届ける。

### 1.2 プロダクト概要
**INNOMA** は、自治体Webサイトをデジタル庁デザインシステム（DA-DS）準拠でリニューアルするための基盤。

- テンプレートベースで自治体サイトを生成
- LLMが自治体公式サイトから情報を自動取得して補完
- 統一されたUIで市民が迷わず情報にアクセス

---

## 2. ターゲットユーザー

### 2.1 プライマリユーザー: 住民（市民）
- 自治体サービスを利用する一般市民
- 高齢者、障害者、外国人を含む全ての住民
- **ゴール**: 必要な行政手続き・サービス情報に迷わず辿り着く

### 2.2 セカンダリユーザー: 運用者
- テンプレートを管理・更新する担当者
- **ゴール**: 効率的にコンテンツを管理・公開

---

## 3. 機能要件

### 3.1 コア機能

#### 3.1.1 テンプレートシステム
| 機能 | 説明 |
|------|------|
| テンプレート複製 | sampleテンプレートを新自治体用に複製 |
| 変数置換 | `{{municipality_name}}`, `{{phone}}` 等を自動置換 |
| 15トピック対応 | 福祉、子育て、税、届出等の主要サービス全般 |

#### 3.1.2 LLM情報取得
| 機能 | 説明 |
|------|------|
| 公式サイト参照 | 対象自治体の公式Webサイトから情報取得 |
| 自動補完 | テンプレートの変数（電話番号、住所、料金等）を自動で埋める |
| 定期更新 | 定期的に最新情報を取得・更新 |

#### 3.1.3 確認・承認フロー
| 機能 | 説明 |
|------|------|
| 下書きモード | LLM取得情報を下書きとして保存 |
| 承認機能 | 運用者が確認後、公開を承認 |
| 自動公開モード | 設定により完全自動公開も可能 |

#### 3.1.4 Webフロントエンド
| 機能 | 説明 |
|------|------|
| DA-DS準拠UI | デジタル庁デザインシステム準拠のReactコンポーネント |
| レスポンシブ | モバイル・デスクトップ対応 |
| アクセシビリティ | WCAG 2.1 AA準拠 |
| 全文検索 | サイト内検索機能 |

### 3.2 管理機能

#### 3.2.1 管理画面
| 機能 | 説明 |
|------|------|
| 自治体一覧 | 登録済み自治体の一覧表示 |
| 新規追加 | 自治体URLを入力して新規追加 |
| 更新トリガー | 手動で情報更新を実行 |
| 下書き確認 | LLM取得情報の確認・編集・承認 |
| 公開設定 | 自動公開/承認後公開の切り替え |

---

## 4. アーキテクチャ

### 4.1 システム構成

```
┌─────────────────────────────────────────────────────────────┐
│                        Vercel                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                  Next.js (apps/web)                  │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │   │
│  │  │   Pages     │  │   Admin     │  │     API     │ │   │
│  │  │ (市民向け)  │  │ (管理画面) │  │   Routes    │ │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘ │   │
│  └─────────────────────────────────────────────────────┘   │
│                              │                               │
│  ┌───────────────────────────┼───────────────────────────┐ │
│  │                     Data Layer                         │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │ │
│  │  │  Artifacts  │  │  Templates  │  │   Drafts    │   │ │
│  │  │   (JSON)    │  │   (JSON)    │  │   (JSON)    │   │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘   │ │
│  └───────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    LLM Information Fetcher                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   Gemini    │  │  Web Fetch  │  │  Validator  │         │
│  │     API     │  │  (公式サイト) │  │  (検証)     │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 データフロー

```
1. 新規自治体追加
   Admin → 自治体URL入力 → テンプレート複製 → LLM情報取得 → 下書き保存

2. 定期更新
   Cron Job → LLM情報取得 → 差分検出 → 下書き保存 or 自動更新

3. 承認公開
   Admin → 下書き確認 → 承認 → Artifact更新 → ISR再検証
```

### 4.3 ディレクトリ構造

```
INNOMA/
├── apps/
│   └── web/                    # Next.js アプリケーション
│       ├── app/
│       │   ├── [municipality]/ # 市民向けページ
│       │   ├── admin/          # 管理画面
│       │   └── api/            # API Routes
│       ├── components/
│       │   ├── blocks/         # DADSブロックコンポーネント
│       │   └── admin/          # 管理画面コンポーネント
│       ├── lib/
│       │   ├── artifact/       # Artifact読み込み
│       │   ├── llm/            # LLM情報取得
│       │   └── template/       # テンプレート処理
│       └── data/
│           └── artifacts/
│               ├── _templates/ # ベーステンプレート
│               ├── _drafts/    # 下書き
│               └── {municipality}/ # 各自治体データ
├── packages/
│   └── schema/                 # 共通スキーマ定義
├── docs/                       # ドキュメント
└── archive/                    # アーカイブ済みコード
```

---

## 5. 技術スタック

| カテゴリ | 技術 |
|----------|------|
| フレームワーク | Next.js 15 (App Router) |
| 言語 | TypeScript |
| スタイリング | Tailwind CSS + DA-DS Tokens |
| デザインシステム | @digital-go-jp/design-tokens |
| スキーマ検証 | Zod |
| LLM | Google Gemini |
| デプロイ | Vercel |
| データストア | ファイルシステム (JSON) |

---

## 6. 非機能要件

### 6.1 パフォーマンス
- ページロード: P95 < 1秒（静的キャッシュ時）
- ISR revalidate: 300秒（通常）、30秒（緊急情報）

### 6.2 アクセシビリティ
- WCAG 2.1 AA準拠
- スクリーンリーダー対応
- キーボードナビゲーション対応

### 6.3 セキュリティ
- 管理画面: 認証必須
- API: レート制限
- LLM出力: サニタイズ

### 6.4 可用性
- 稼働率: 99.9%/月（Vercel SLA依存）

---

## 7. フェーズ計画

### Phase 1: MVP（現在）
- [x] テンプレートシステム
- [x] DA-DS準拠フロントエンド
- [x] 全文検索
- [ ] 管理画面（基本）
- [ ] LLM情報取得（基本）

### Phase 2: 運用機能
- [ ] 定期更新機能
- [ ] 承認ワークフロー
- [ ] 複数自治体運用

### Phase 3: 拡張機能
- [ ] 多言語対応
- [ ] 災害時優先更新
- [ ] アナリティクス

---

## 8. 決定事項

| 項目 | 決定内容 | 理由 |
|------|----------|------|
| スクレイピングパイプライン | 不使用（アーカイブ） | テンプレート+LLM補完で十分 |
| データストア | ファイルシステム（JSON） | シンプル、Vercel対応 |
| LLM | Gemini | コスト、日本語性能 |
| 情報ソース | 自治体公式サイト | 信頼性 |

---

## 9. 今後の検討事項

- [ ] LLM情報取得の精度検証
- [ ] 管理画面の認証方式
- [ ] 定期更新のスケジュール設計
- [ ] エラーハンドリング・リトライ戦略
